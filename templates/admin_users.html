{% extends "base.html" %}

{% block title %}–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h2>üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å</h2>
        <p class="admin-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Å–∏—Å—Ç–µ–º—ã</p>
    </div>

    <div class="admin-stats">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">{{ users|length }}</div>
                <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ users|selectattr('role', 'equalto', 'client')|list|length }}</div>
                <div class="stat-label">–ö–ª–∏–µ–Ω—Ç–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ users|selectattr('role', 'equalto', 'customer')|list|length }}</div>
                <div class="stat-label">–ó–∞–∫–∞–∑—á–∏–∫–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ users|selectattr('role', 'equalto', 'admin')|list|length }}</div>
                <div class="stat-label">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤</div>
            </div>
        </div>
    </div>

    <div class="users-table-container">
        <div class="table-header">
            <h3>üìã –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
            <div class="table-actions">
                <input type="text" id="searchUsers" placeholder="–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π..." class="search-input">
            </div>
        </div>

        <div class="table-responsive">
            <table class="users-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</th>
                        <th>Email</th>
                        <th>–†–æ–ª—å</th>
                        <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr class="user-row">
                        <td class="user-id">{{ user.id }}</td>
                        <td class="user-username">
                            <strong>{{ user.username }}</strong>
                        </td>
                        <td class="user-email">{{ user.email }}</td>
                        <td class="user-role">
                            <span class="role-badge role-{{ user.role }}">
                                {% if user.role == 'admin' %}
                                    –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
                                {% elif user.role == 'customer' %}
                                    –ó–∞–∫–∞–∑—á–∏–∫
                                {% else %}
                                    –ö–ª–∏–µ–Ω—Ç
                                {% endif %}
                            </span>
                        </td>
                        <td class="user-created">{{ user.created_at.strftime('%d.%m.%Y %H:%M') }}</td>
                        <td class="user-status">
                            <span class="status-{{ 'active' if user.is_active else 'inactive' }}">
                                {{ '–ê–∫—Ç–∏–≤–µ–Ω' if user.is_active else '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω' }}
                            </span>
                        </td>
                        <td class="user-actions">
                            <button class="btn btn-sm btn-info" onclick="viewUser({{ user.id }})">üëÅÔ∏è</button>
                            <button class="btn btn-sm btn-warning" onclick="editUser({{ user.id }})">‚úèÔ∏è</button>
                            {% if user.id != current_user.id %}
                                <button class="btn btn-sm btn-{{ 'success' if not user.is_active else 'danger' }}"
                                        onclick="toggleUser({{ user.id }})">
                                    {{ '–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å' if not user.is_active else '–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å' }}
                                </button>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {% if not users %}
        <div class="empty-state">
            <div class="empty-icon">üì≠</div>
            <h4>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
            <p>–í —Å–∏—Å—Ç–µ–º–µ –µ—â–µ –Ω–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.</p>
        </div>
        {% endif %}
    </div>

    <div class="admin-actions">
        <a href="{{ url_for('index') }}" class="btn btn-secondary">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
        <a href="{{ url_for('profile') }}" class="btn btn-info">üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function viewUser(userId) {
    alert('–ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ID: ' + userId);
    // –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
}

function editUser(userId) {
    alert('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ID: ' + userId);
    // –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
}

function toggleUser(userId) {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')) {
        alert('–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ID: ' + userId);
        // –ó–¥–µ—Å—å –±—É–¥–µ—Ç AJAX –∑–∞–ø—Ä–æ—Å –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
    }
}

// –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
document.getElementById('searchUsers').addEventListener('input', function(e) {
    const searchTerm = e.target.value.toLowerCase();
    const rows = document.querySelectorAll('.user-row');
    
    rows.forEach(row => {
        const username = row.querySelector('.user-username').textContent.toLowerCase();
        const email = row.querySelector('.user-email').textContent.toLowerCase();
        const role = row.querySelector('.user-role').textContent.toLowerCase();
        
        if (username.includes(searchTerm) || email.includes(searchTerm) || role.includes(searchTerm)) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
});
</script>
{% endblock %}