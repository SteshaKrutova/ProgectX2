{% extends "base.html" %}

{% block title %}–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h2> –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å</h2>
        <p class="admin-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Å–∏—Å—Ç–µ–º—ã</p>
    </div>

    <div class="admin-stats">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">{{ users|length }}</div>
                <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ users|selectattr('role', 'equalto', 'client')|list|length }}</div>
                <div class="stat-label">–ö–ª–∏–µ–Ω—Ç–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">0</div>
                <div class="stat-label">–û–Ω–ª–∞–π–Ω —Å–µ–π—á–∞—Å</div>
            </div>
        </div>
    </div>

    <div class="users-table-container">
        <div class="table-header">
            <h3>üìã –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
            
            <div class="table-actions">
                <select id="filterStatus" class="filter-select">
                    <option value="all">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                    <option value="active">–¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ</option>
                    <option value="inactive">–¢–æ–ª—å–∫–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ</option>
                </select>
            </div>
        </div>

        <div class="table-responsive">
            <table class="users-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</th>
                        <th>Email</th>
                        <th>–†–æ–ª—å</th>
                        <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr class="user-row" data-status="{{ 'active' if user.is_active else 'inactive' }}">
                        <td class="user-id">{{ user.id }}</td>
                        <td class="user-username">
                            <strong>{{ user.username }}</strong>
                            {% if not user.is_active %}
                            <br><small style="color: #dc3545;">üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</small>
                            {% endif %}
                        </td>
                        <td class="user-email">{{ user.email }}</td>
                        <td class="user-role">
                            <span class="role-badge role-{{ user.role }}">
                                {% if user.role == 'admin' %}
                                    –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
                                {% elif user.role == 'customer' %}
                                    –ó–∞–∫–∞–∑—á–∏–∫
                                {% else %}
                                    –ö–ª–∏–µ–Ω—Ç
                                {% endif %}
                            </span>
                        </td>
                        <td class="user-created">{{ user.created_at.strftime('%d.%m.%Y %H:%M') }}</td>
                        <td class="user-status">
                            <span class="status-{{ 'active' if user.is_active else 'inactive' }}">
                                {{ '–ê–∫—Ç–∏–≤–µ–Ω' if user.is_active else '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' }}
                            </span>
                        </td>
                        <td class="user-actions">
                            {% if user.id != current_user.id %}
                                <a href="{{ url_for('toggle_user', user_id=user.id) }}" 
                                   class="btn btn-sm btn-{{ 'success' if not user.is_active else 'danger' }}"
                                   onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ {{ '—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' if not user.is_active else '–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' }} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ user.username }}?')">
                                    {{ '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' if not user.is_active else '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' }}
                                </a>
                                <a href="{{ url_for('delete_user', user_id=user.id) }}" 
                                   class="btn btn-sm btn-danger"
                                   onclick="return confirm('‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï! –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ user.username }}? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å! –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—É–¥—É—Ç –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ —É–¥–∞–ª–µ–Ω—ã.')">
                                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                </a>
                            {% else %}
                                <button class="btn btn-sm btn-secondary" disabled>–¢–µ–∫—É—â–∏–π</button>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {% if not users %}
        <div class="empty-state">
            <div class="empty-icon">üì≠</div>
            <h4>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
            <p>–í —Å–∏—Å—Ç–µ–º–µ –µ—â–µ –Ω–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.</p>
        </div>
        {% endif %}
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="add-user-container" style="text-align: center; margin: 20px 0;">
        <a href="{{ url_for('admin_add_user') }}" class="btn btn-success">
            ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        </a>
    </div>

    <div class="admin-actions">
        <a href="{{ url_for('index') }}" class="btn btn-secondary">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
    </div>
</div>

<style>
.status-active {
    color: #28a745;
    font-weight: 500;
    background: rgba(40, 167, 69, 0.1);
    padding: 4px 8px;
    border-radius: 4px;
}

.status-inactive {
    color: #dc3545;
    font-weight: 500;
    background: rgba(220, 53, 69, 0.1);
    padding: 4px 8px;
    border-radius: 4px;
}

.filter-select {
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
    margin-left: 10px;
}

.user-row[data-status="inactive"] {
    background-color: rgba(220, 53, 69, 0.05);
}

.user-row[data-status="inactive"]:hover {
    background-color: rgba(220, 53, 69, 0.1);
}

.user-actions {
    text-align: center;
    min-width: 140px;
}

.table-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.table-actions {
    display: flex;
    gap: 10px;
}

@media (max-width: 768px) {
    .table-header {
        flex-direction: column;
        gap: 15px;
        text-align: center;
    }
    
    .table-actions {
        justify-content: center;
    }
    
    .user-actions {
        min-width: 120px;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É
document.getElementById('filterStatus').addEventListener('change', function(e) {
    const status = e.target.value;
    const rows = document.querySelectorAll('.user-row');
    
    rows.forEach(row => {
        const rowStatus = row.getAttribute('data-status');
        
        if (status === 'all' || status === rowStatus) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
});
</script>
{% endblock %}