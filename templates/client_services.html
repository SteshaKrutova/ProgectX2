{% extends "base.html" %}

{% block title %}–ú–æ–∏ —É—Å–ª—É–≥–∏ - ProjectX2{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h2>üë§ –ú–æ–∏ —É—Å–ª—É–≥–∏</h2>
        <div class="balance-info">
            <span class="balance-amount">–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: {{ current_user.balance }} —Ä—É–±.</span>
        </div>
    </div>

    <!-- –£—Å–ª—É–≥–∏ -->
    <div class="services-section">
        <h3>üì¶ –£—Å–ª—É–≥–∏</h3>
        {% if services %}
            <div class="services-grid">
                {% for service in services %}
                <div class="service-card {% if service.in_development %}service-development{% endif %}">
                    {% if service.in_development %}
                    <div class="development-badge">üöß –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</div>
                    {% endif %}
                    
                    <div class="service-header">
                        <h4>{{ service.name }}</h4>
                        
                        <!-- –®–µ—Å—Ç–µ—Ä—ë–Ω–∫–∞ –¥–ª—è Ping —Å–µ—Ä–≤–µ—Ä–∞ –∏–ª–∏ –∫–Ω–æ–ø–∫–∞ –¥–ª—è –ø–æ–≥–æ–¥—ã -->
                        {% if service.name == '–ü–∏–Ω–≥ —Å–µ—Ä–≤–µ—Ä–∞' and service.id in connected_service_ids %}
                            <a href="{{ url_for('ping_service') }}" class="gear-icon" title="–ü–µ—Ä–µ–π—Ç–∏ –∫ Ping —Å–µ—Ä–≤–∏—Å—É">
                                üõ†Ô∏è
                            </a>
                        {% elif service.name == '–°–ª–µ–∂–∫–∞ –∑–∞ –ø–æ–≥–æ–¥–æ–π' and service.id in connected_service_ids %}
                            <a href="{{ url_for('check_weather_now') }}" class="btn btn-sm btn-info weather-btn">
                                üå§Ô∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–≥–æ–¥—É
                            </a>
                        {% else %}
                            <span class="service-price">üí∞ {{ service.price }} —Ä—É–±.</span>
                        {% endif %}
                    </div>
                    
                    <p class="service-description">{{ service.description }}</p>
                    
                    <div class="service-actions">
                        {% if service.id in connected_service_ids %}
                            <span class="badge connected">‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∞</span>
                            <a href="{{ url_for('disconnect_service', service_id=service.id) }}" 
                               class="btn btn-sm btn-warning"
                               onclick="return confirm('–û—Ç–∫–ª—é—á–∏—Ç—å —É—Å–ª—É–≥—É ¬´{{ service.name }}¬ª?')">
                                –û—Ç–∫–ª—é—á–∏—Ç—å
                            </a>
                        {% else %}
                            {% if service.in_development %}
                                <span class="badge development">üöß –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</span>
                            {% elif current_user.balance >= service.price %}
                                <a href="{{ url_for('connect_service', service_id=service.id) }}" 
                                   class="btn btn-sm btn-primary">
                                    –ü–æ–¥–∫–ª—é—á–∏—Ç—å
                                </a>
                            {% else %}
                                <span class="text-danger">–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤</span>
                                <a href="{{ url_for('add_balance_page') }}" class="btn btn-sm btn-success">
                                    –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å
                                </a>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <div class="empty-icon">üì≠</div>
                <h4>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É—Å–ª—É–≥</h4>
                <p>–í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —É—Å–ª—É–≥ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.</p>
            </div>
        {% endif %}
    </div>

    <div class="admin-actions">
        <a href="{{ url_for('index') }}" class="btn btn-secondary">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
        <a href="{{ url_for('profile') }}" class="btn btn-info">üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a>
    </div>
</div>

<style>
/* –°—Ç–∏–ª–∏ –¥–ª—è —É—Å–ª—É–≥ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ */
.service-development {
    opacity: 0.7;
    background-color: #f8f9fa !important;
    border: 1px dashed #6c757d;
    position: relative;
}

.service-development .service-description {
    color: #6c757d !important;
}

.service-development .service-price {
    color: #6c757d !important;
}

.development-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    background: linear-gradient(135deg, #ff6b6b, #ee5a24);
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: bold;
    z-index: 10;
}

/* –ë–µ–π–¥–∂ "–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ" */
.badge.development {
    background: linear-gradient(135deg, #ff6b6b, #ee5a24);
    color: white;
    padding: 5px 10px;
    border-radius: 15px;
    font-size: 12px;
    font-weight: bold;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —à–µ—Å—Ç–µ—Ä—ë–Ω–∫–∏ */
.gear-icon {
    font-size: 24px;
    text-decoration: none;
    padding: 8px;
    border-radius: 50%;
    background: rgba(255, 193, 7, 0.2);
    transition: all 0.3s ease;
    display: inline-block;
}

.gear-icon:hover {
    background: rgba(255, 193, 7, 0.4);
    transform: rotate(45deg);
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø–æ–≥–æ–¥—ã */
.weather-btn {
    font-size: 14px;
    padding: 6px 12px;
    margin: 0;
}

/* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ —É—Å–ª—É–≥ */
.services-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.service-card {
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    transition: transform 0.3s ease;
    position: relative;
}

.service-card:hover {
    transform: translateY(-2px);
}

.service-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.service-header h4 {
    margin: 0;
    color: #2c3e50;
}

.service-price {
    color: #27ae60;
    font-weight: bold;
}

.service-description {
    color: #6c757d;
    margin-bottom: 20px;
    line-height: 1.5;
}

.service-actions {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
}

.badge.connected {
    background: #d4edda;
    color: #155724;
    padding: 5px 10px;
    border-radius: 15px;
    font-size: 12px;
}

.text-danger {
    color: #dc3545;
}

.empty-state {
    text-align: center;
    padding: 40px 20px;
}

.empty-icon {
    font-size: 64px;
    margin-bottom: 15px;
}

.empty-state h4 {
    color: #6c757d;
    margin-bottom: 10px;
}

.empty-state p {
    color: #adb5bd;
    margin-bottom: 20px;
}

.admin-actions {
    margin-top: 30px;
    display: flex;
    gap: 15px;
    justify-content: center;
}

@media (max-width: 768px) {
    .services-grid {
        grid-template-columns: 1fr;
    }
    
    .service-actions {
        flex-direction: column;
        align-items: stretch;
    }
    
    .admin-actions {
        flex-direction: column;
    }
    
    .gear-icon {
        font-size: 20px;
        padding: 6px;
    }
    
    .weather-btn {
        font-size: 12px;
        padding: 4px 8px;
    }
    
    .development-badge {
        font-size: 10px;
        padding: 3px 6px;
    }
    
    .badge.development {
        font-size: 11px;
        padding: 4px 8px;
    }
}
</style>
{% endblock %}