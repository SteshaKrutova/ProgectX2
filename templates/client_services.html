{% extends "base.html" %}

{% block title %}–ú–æ–∏ —É—Å–ª—É–≥–∏ - ProjectX2{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h2>üë§ –ú–æ–∏ —É—Å–ª—É–≥–∏</h2>
    </div>

    <!-- –£—Å–ª—É–≥–∏ -->
    <div class="services-section" style="margin-top: 20px;">
        <h3>–£—Å–ª—É–≥–∏</h3>
        {% if services %}
            <div class="services-grid">
                {% for service in services %}
                <div class="service-card">
                    <div class="service-header">
                        <h4>{{ service.name }}</h4>
                        <span class="service-price">üí∞ {{ service.price }} —Ä—É–±.</span>
                    </div>
                    
                    <p class="service-description">{{ service.description }}</p>
                    
                    <div class="service-actions">
                        {% if service.id in connected_service_ids %}
                            <span class="badge connected">‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∞</span>
                            <a href="{{ url_for('disconnect_service', service_id=service.id) }}" 
                               class="btn btn-sm btn-warning"
                               onclick="return confirm('–û—Ç–∫–ª—é—á–∏—Ç—å —É—Å–ª—É–≥—É ¬´{{ service.name }}¬ª?')">
                                –û—Ç–∫–ª—é—á–∏—Ç—å
                            </a>
                        {% else %}
                            {% if current_user.balance >= service.price %}
                                <a href="{{ url_for('connect_service', service_id=service.id) }}" 
                                   class="btn btn-sm btn-primary">
                                    –ü–æ–¥–∫–ª—é—á–∏—Ç—å
                                </a>
                            {% else %}
                                <span class="text-danger">–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤</span>
                                <button class="btn btn-sm btn-success" onclick="showAddBalanceModal()">
                                    –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å
                                </button>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <div class="empty-icon">üì≠</div>
                <h4>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É—Å–ª—É–≥</h4>
                <p>–í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —É—Å–ª—É–≥ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.</p>
            </div>
        {% endif %}
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ -->
    <div id="addBalanceModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</h3>
            <form onsubmit="addBalance(event)">
                <div class="form-group">
                    <label>–°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è:</label>
                    <input type="number" step="0.01" min="1" required 
                           class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É">
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-success">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
                    <button type="button" class="btn btn-secondary" 
                            onclick="document.getElementById('addBalanceModal').style.display='none'">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="admin-actions" style="margin-top: 20px;">
        <a href="{{ url_for('index') }}" class="btn btn-secondary">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
    </div>
</div>

<script>
function showAddBalanceModal() {
    document.getElementById('addBalanceModal').style.display = 'block';
}

function addBalance(event) {
    event.preventDefault();
    const amount = event.target.querySelector('input').value;
    
    fetch('{{ url_for("add_balance") }}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: 'amount=' + encodeURIComponent(amount)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            location.reload();
        } else {
            alert('–û—à–∏–±–∫–∞: ' + data.message);
        }
    })
    .catch(error => {
        alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error);
    });
}
</script>
{% endblock %}