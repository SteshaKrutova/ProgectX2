<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ProjectX2{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <nav class="navbar">
            <h1><a href="/" class="nav-logo">ProjectX2</a></h1>
            <div class="nav-links">
                {% if current_user.is_authenticated %}
                    <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ -->
                    {% if current_user.role == 'client' %}
                    <div class="balance-info">
                        <span class="balance-amount">üí∞ {{ current_user.balance }} —Ä—É–±.</span>
                        <button class="balance-btn" onclick="showAddBalanceModal()">+</button>
                    </div>
                    {% endif %}
                    
                    <a href="/profile" class="nav-link">üë§ {{ current_user.username }}</a>
                    
                    {% if current_user.role == 'customer' %}
                        <a href="{{ url_for('customer_services') }}" class="nav-link">üìã –£—Å–ª—É–≥–∏</a>
                        <a href="{{ url_for('customer_stats') }}" class="nav-link">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
                    {% elif current_user.role == 'admin' %}
                        <a href="{{ url_for('admin_users') }}" class="nav-link">üëë –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
                    {% endif %}
                    
                    <a href="/logout" class="nav-link">–í—ã–π—Ç–∏</a>
                {% else %}
                    <a href="/login" class="nav-link">–í–æ–π—Ç–∏</a>
                    <a href="/register" class="nav-link">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                {% endif %}
            </div>
        </nav>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ -->
        <div id="addBalanceModal" class="modal" style="display: none;">
            <div class="modal-content">
                <h3>üí∞ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</h3>
                <form onsubmit="addBalance(event)">
                    <div class="form-group">
                        <label>–°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è (—Ä—É–±.):</label>
                        <input type="number" step="0.01" min="1" required 
                            class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É" id="balanceAmount">
                    </div>
                    <div class="modal-actions">
                        <button type="submit" class="btn btn-success">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
                        <button type="button" class="btn btn-secondary" 
                                onclick="document.getElementById('addBalanceModal').style.display='none'">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div class="flash-messages">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="flash flash-{{ category }}">{{ message }}</div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
        </div>

        <main>
            {% block content %}{% endblock %}
        </main>
    </div>
    
    {% block extra_js %}{% endblock %}
</body>
</html>



<script>
// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–ª–∞–Ω—Å–æ–º
function showAddBalanceModal() {
    document.getElementById('addBalanceModal').style.display = 'flex';
    document.getElementById('balanceAmount').focus();
}

function addBalance(event) {
    event.preventDefault();
    const amount = document.getElementById('balanceAmount').value;
    
    fetch('{{ url_for("add_balance") }}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: 'amount=' + encodeURIComponent(amount)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            location.reload();
        } else {
            alert('–û—à–∏–±–∫–∞: ' + data.message);
        }
        document.getElementById('addBalanceModal').style.display = 'none';
    })
    .catch(error => {
        alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error);
        document.getElementById('addBalanceModal').style.display = 'none';
    });
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
document.addEventListener('click', function(event) {
    const modal = document.getElementById('addBalanceModal');
    if (event.target === modal) {
        modal.style.display = 'none';
    }
});

// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ ESC
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        document.getElementById('addBalanceModal').style.display = 'none';
    }
});
</script>